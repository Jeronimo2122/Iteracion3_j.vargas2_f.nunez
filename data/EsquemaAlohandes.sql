--- Sentencias SQL para la creaci�n del esquema de parranderos
--- Las tablas tienen prefijo A_ para facilitar su acceso desde SQL Developer

-- USO
-- Copie el contenido de este archivo en una pesta�a SQL de SQL Developer
-- Ejec�telo como un script - Utilice el bot�n correspondiente de la pesta�a utilizada

-- Creaci�n del secuenciador
create sequence Alohandes_sequence;

--1--------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE CLIENTE(
    IDENTIFICACION NUMBER NOT NULL, 
    NOMBRE VARCHAR2(50) NOT NULL,
    VINCULO VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_CLIENTE PRIMARY KEY(IDENTIFICACION)
);
ALTER TABLE CLIENTE
ADD CONSTRAINT VALUE_VINCULO_CLIENTE 
CHECK (VINCULO IN ('ESTUDIANTE','PROFESOR','EMPLEADO','INVITADO','EGRESADO','PADRE','COLECTIVA'))
;
--2----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE OPERADOR(
    ID NUMBER, 
    NOMBRE VARCHAR2 (50) NOT NULL,
    GANANCIAS NUMBER NOT NULL
);
ALTER TABLE OPERADOR
ADD CONSTRAINT PK_OPERADOR
PRIMARY KEY (ID)
;
--3----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE ALOJAMIENTO(
    ID NUMBER NOT NULL, 
    CAPACIDAD NUMBER NOT NULL,
    ESTADO VARCHAR2(50) NOT NULL,
    DIRECCION VARCHAR2(100),
    TIPO_ALOJA VARCHAR2(50) NOT NULL,
    CONSTRAINT PK_ALOJAMIENTO PRIMARY KEY(ID)
);
ALTER TABLE ALOJAMIENTO
ADD CONSTRAINT VALUE_TIPOALOJA
CHECK (TIPO_ALOJA IN ('VIVIENDA_U','HABITACION_HOTEL','HABITACION_HOSTAL',
'VIVIENDA','APARTAMENTO','HABITACION_VIVIENDA'))

ADD CONSTRAINT VALUE_ESTADO_ALOJA 
CHECK (ESTADO IN ('DISPONIBLE','DESHABILITADO'))
;
--4----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE SERVICIO(
    ID NUMBER NOT NULL ,
    NOMBRE VARCHAR(50) NOT NULL,
    CONSTRAINT PK_SERVICIO PRIMARY KEY(ID)
);
--5----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE RESERVA(
    ID NUMBER NOT NULL, 
    FECHA_LLEGADA DATE NOT NULL, 
    FECHA_SALIDA DATE NOT NULL,
    PRECIO NUMBER NOT NULL,
    ID_CLIENTE NUMBER NOT NULL, 
    ID_ALOJAMIENTO NUMBER NOT NULL,  
    ESTADO VARCHAR2(9) NOT NULL,
    CONSTRAINT ID_RESERVA PRIMARY KEY(ID) 
);
ALTER TABLE RESERVA
ADD CONSTRAINT VALUE_PRECIO
CHECK (PRECIO > 0)

ADD CONSTRAINT FK_CLIENTE 
FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(IDENTIFICACION)

ADD CONSTRAINT FK_ALOJAMIENTO 
FOREIGN KEY (ID_ALOJAMIENTO) REFERENCES ALOJAMIENTO(ID)

ADD CONSTRAINT VALUE_ESTADO_RESERVA 
CHECK (ESTADO IN ('ACTIVA','CANCELADA'))

ADD fecha_insercion DATE DEFAULT SYSDATE
;
--6----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE HAB_HOTEL(
    ID_ALOJA NUMBER NOT NULL, 
    CATEGORIA VARCHAR2(20),
    CONSTRAINT FK_PK_ID_HAB_HOT PRIMARY KEY(ID_ALOJA)
);
ALTER TABLE HAB_HOTEL
ADD CONSTRAINT FK_ID_ALOJ_HOTEL
FOREIGN KEY (ID_ALOJA) REFERENCES ALOJAMIENTO(ID)

ADD CONSTRAINT CATEG_HABITACION
CHECK (CATEGORIA IN ('SUIT','SEMISUIT','ESTANDAR'))
;
--7----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE HAB_HOSTAL(
    ID_ALOJA NUMBER NOT NULL, 
    HORA_APERTURA DATE NULL,
    HORA_CIERRE DATE NULL,
    CONSTRAINT FK_PK_ID_HAB_HOS PRIMARY KEY(ID_ALOJA)
);
ALTER TABLE HAB_HOSTAL
ADD CONSTRAINT FK_ID_ALOJ_HOSTAL
FOREIGN KEY (ID_ALOJA) REFERENCES ALOJAMIENTO(ID)

ADD CONSTRAINT HORAS
CHECK (HORA_APERTURA < HORA_CIERRE)
;
--8----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE ALOJAMIENTO_SERVICIO(
    ID_ALOJA NUMBER NOT NULL,
    ID_SERVICIO NUMBER NOT NULL
);
ALTER TABLE ALOJAMIENTO_SERVICIO
ADD CONSTRAINT PK_ALOJA_SERVICIO
PRIMARY KEY (ID_ALOJA, ID_SERVICIO)

ADD CONSTRAINT FK_ALOJA_AS
FOREIGN KEY (ID_ALOJA) REFERENCES ALOJAMIENTO(ID)

ADD CONSTRAINT FK_SERVICIO_AS
FOREIGN KEY(ID_SERVICIO) REFERENCES SERVICIO(ID)
;
--9----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE ALOJAMIENTO_OPERADOR(
    ID_ALOJA NUMBER NOT NULL,
    ID_OPERADOR NUMBER NOT NULL
);
ALTER TABLE ALOJAMIENTO_OPERADOR
ADD CONSTRAINT PK_ALOJA_OPERADOR
PRIMARY KEY (ID_ALOJA, ID_OPERADOR)

ADD CONSTRAINT FK_ALOJA_AO
FOREIGN KEY (ID_ALOJA) REFERENCES ALOJAMIENTO(ID)

ADD CONSTRAINT FK_OPERADOR_AO
FOREIGN KEY(ID_OPERADOR) REFERENCES OPERADOR(ID)
;
--10----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE EDIFICIO_UNIVERSITARIO(
    ID NUMBER,
    NUMVIVIENDAS NUMBER NOT NULL, 
    NUMDISPONIBLE NUMBER NOT NULL,
    DIRECCION VARCHAR2 (150) NOT NULL
);
ALTER TABLE EDIFICIO_UNIVERSITARIO
ADD CONSTRAINT PK_EDIFICIO_UNIVERSITARIO
PRIMARY KEY (ID)

ADD CONSTRAINT FK_EDIFICIO_UNIVERSITARIO
FOREIGN KEY (ID) REFERENCES OPERADOR(ID)

ADD CONSTRAINT CK_EDIFICIO_UNIVERSITARIO
CHECK (NUMDISPONIBLE >= 0 
    AND NUMDISPONIBLE <= NUMVIVIENDAS)
;
--11----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE HOTEL_HOSTAL(
    ID NUMBER,
    ESTADO_LEGAL VARCHAR (10) NOT NULL,
    NUMERO_REGISTRO_CC NUMBER,
    NUM_HABITACIONES NUMBER NOT NULL,
    HABITACIONES_DISPONIBLES NUMBER NOT NULL,
    DIRECCION VARCHAR2 (150) NOT NULL
);
ALTER TABLE HOTEL_HOSTAL
ADD CONSTRAINT PK_HOTEL_HOSTAL
PRIMARY KEY (ID)

ADD CONSTRAINT FK_HOTEL_HOSTAL
FOREIGN KEY (ID) REFERENCES OPERADOR (ID)

ADD CONSTRAINT CK_HOTEL_HOSTAL
CHECK (ESTADO_LEGAL in ('VIGENTE','VENCIDO') 
    AND HABITACIONES_DISPONIBLES >= 0 
    AND HABITACIONES_DISPONIBLES <= NUM_HABITACIONES)
;
--12----------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE PERSONA(
    ID NUMBER,
    IDENTIFICACION NUMBER,
    VINCULO VARCHAR2(20) NOT NULL
);
ALTER TABLE PERSONA 
ADD CONSTRAINT PK_PERSONA
PRIMARY KEY(ID)

ADD CONSTRAINT FK_PERSONA
FOREIGN KEY (ID) REFERENCES OPERADOR (ID)

ADD CONSTRAINT CK_PERSONA
CHECK (VINCULO in ('ESTUDIANTE','PROFESOR','EMPLEADO','PADRE','EGRESADO'))
;
COMMIT;

